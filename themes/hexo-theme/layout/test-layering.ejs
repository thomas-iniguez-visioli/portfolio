<!DOCTYPE html>
<html lang="<%- config.language %>" class="dev-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Correction Superposition - <%= config.title %></title>
    
    <!-- CSS de base avec url_for -->
    <link rel="stylesheet" href="<%= url_for('/css/reset.css') %>">
    <link rel="stylesheet" href="<%= url_for('/css/variables.css') %>">
    <link rel="stylesheet" href="<%= url_for('/css/layout.css') %>">
    <link rel="stylesheet" href="<%= url_for('/css/header.css') %>">
    <link rel="stylesheet" href="<%= url_for('/css/sidebar.css') %>">
    <link rel="stylesheet" href="<%= url_for('/css/buttons.css') %>">
    <link rel="stylesheet" href="<%= url_for('/css/cards.css') %>">
    <link rel="stylesheet" href="<%= url_for('/css/dev-components.css') %>">
    
    <!-- CORRECTION D'URGENCE - À CHARGER EN DERNIER -->
    <link rel="stylesheet" href="<%= url_for('/css/layering-emergency-fix.css') %>">
    
    <style>
        /* Styles de test */
        .test-content {
            padding: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f8fafc;
        }
        
        .test-button {
            margin: 0.5rem;
            padding: 0.5rem 1rem;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .status-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #059669;
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
        }
        
        .test-status {
            font-weight: bold;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }
        
        .status-ok {
            background: #dcfce7;
            color: #166534;
        }
        
        .status-error {
            background: #fef2f2;
            color: #dc2626;
        }
    </style>
</head>
<body class="dev-layout modern-layout dev-theme-loaded">
    <!-- Indicateur de statut -->
    <div class="status-indicator">
        🔧 Corrections Hexo Actives
    </div>
    
    <!-- Skip link -->
    <a href="#main-content" class="dev-skip-link skip-link">Aller au contenu</a>
    
    <div class="dev-page-grid page-grid">
        <!-- Header -->
        <header class="page-header dev-header">
            <div class="container">
                <div class="header-content">
                    <div class="header-brand">
                        <a href="<%= url_for('/') %>" class="brand-link">
                            <span class="brand-text"><%= config.title %> - Test</span>
                        </a>
                    </div>
                    
                    <nav class="header-nav">
                        <button class="nav-toggle" aria-expanded="false">
                            <span class="nav-toggle-icon"></span>
                            <span class="nav-toggle-icon"></span>
                            <span class="nav-toggle-icon"></span>
                        </button>
                        
                        <ul class="nav-menu">
                            <li class="nav-item">
                                <a href="<%= url_for('/') %>" class="nav-link">Accueil</a>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">Test</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>
        
        <!-- Contenu principal -->
        <main class="dev-page-main page-main" role="main" id="main-content">
            <div class="dev-layout-container layout-with-sidebar">
                <!-- Sidebar -->
                <aside class="dev-sidebar" id="dev-sidebar">
                    <div class="dev-sidebar-content">
                        <div class="dev-sidebar-section">
                            <h3>Navigation</h3>
                            <ul class="dev-nav-list">
                                <li class="dev-nav-item">
                                    <a href="<%= url_for('/') %>" class="dev-nav-link active">
                                        <span class="dev-nav-text">Accueil</span>
                                    </a>
                                </li>
                                <li class="dev-nav-item">
                                    <a href="#" class="dev-nav-link">
                                        <span class="dev-nav-text">Test Corrections</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="dev-sidebar-section">
                            <h4>Technologies</h4>
                            <div class="dev-tech-badges">
                                <span class="dev-tech-badge javascript">JavaScript</span>
                                <span class="dev-tech-badge react">React</span>
                                <span class="dev-tech-badge node">Node.js</span>
                                <span class="dev-tech-badge docker">Docker</span>
                            </div>
                        </div>
                        
                        <div class="dev-sidebar-section">
                            <h4>Statut</h4>
                            <div class="dev-status dev-status--online">
                                Corrections actives
                            </div>
                        </div>
                    </div>
                </aside>
                
                <!-- Toggle mobile -->
                <button class="dev-sidebar-toggle" aria-expanded="false">
                    <div class="dev-sidebar-toggle-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </button>
                
                <!-- Contenu principal -->
                <div class="dev-main-content main-content">
                    <div class="test-content">
                        <h1>Test des Corrections Hexo - Superposition</h1>
                        <p>Cette page teste les corrections d'urgence intégrées dans Hexo avec <code>url_for</code>.</p>
                        
                        <div class="test-section">
                            <h2>🔧 Informations Système</h2>
                            <ul>
                                <li><strong>Site:</strong> <%= config.title %></li>
                                <li><strong>URL:</strong> <%= config.url %></li>
                                <li><strong>Thème:</strong> <%= config.theme %></li>
                                <li><strong>Langue:</strong> <%= config.language %></li>
                            </ul>
                        </div>
                        
                        <div class="test-section">
                            <h2>Test 1: Header Sticky</h2>
                            <p>Le header doit rester en haut lors du scroll.</p>
                            <p><strong>Status:</strong> <span id="header-status" class="test-status">En cours...</span></p>
                        </div>
                        
                        <div class="test-section">
                            <h2>Test 2: Sidebar Mobile</h2>
                            <p>La sidebar doit s'ouvrir/fermer correctement sur mobile.</p>
                            <p><strong>Status:</strong> <span id="sidebar-status" class="test-status">En cours...</span></p>
                            <button class="test-button" onclick="testSidebar()">Tester Sidebar</button>
                        </div>
                        
                        <div class="test-section">
                            <h2>Test 3: Z-Index Variables</h2>
                            <p>Les variables CSS z-index doivent être correctement définies.</p>
                            <p><strong>Status:</strong> <span id="zindex-status" class="test-status">En cours...</span></p>
                            <button class="test-button" onclick="testZIndex()">Vérifier Z-Index</button>
                        </div>
                        
                        <div class="test-section">
                            <h2>Test 4: Composants</h2>
                            <p>Les composants ne doivent pas se chevaucher.</p>
                            
                            <!-- Cartes de test -->
                            <div class="cards-grid" style="margin: 1rem 0;">
                                <div class="card">
                                    <div class="card-content">
                                        <h3 class="card-title">Carte Test 1</h3>
                                        <p class="card-description">Test des cartes sans chevauchement.</p>
                                        <div class="dev-tech-badges">
                                            <span class="dev-tech-badge javascript">JS</span>
                                            <span class="dev-tech-badge react">React</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-content">
                                        <h3 class="card-title">Carte Test 2</h3>
                                        <p class="card-description">Deuxième carte de test.</p>
                                        <div class="dev-tech-badges">
                                            <span class="dev-tech-badge node">Node</span>
                                            <span class="dev-tech-badge docker">Docker</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="card">
                                    <div class="card-content">
                                        <h3 class="card-title">Carte Test 3</h3>
                                        <p class="card-description">Troisième carte de test.</p>
                                        <div class="dev-tech-badges">
                                            <span class="dev-tech-badge python">Python</span>
                                            <span class="dev-tech-badge aws">AWS</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="test-section">
                            <h2>Test 5: Boutons et Interactions</h2>
                            <p>Les boutons doivent être cliquables et visibles.</p>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin: 1rem 0;">
                                <button class="btn btn-primary">Primary</button>
                                <button class="btn btn-secondary">Secondary</button>
                                <button class="btn btn-terminal">Terminal</button>
                                <button class="btn btn-ghost">Ghost</button>
                            </div>
                        </div>
                        
                        <div class="test-section">
                            <h2>Test 6: URLs Hexo</h2>
                            <p>Test des URLs générées par Hexo:</p>
                            <ul>
                                <li><strong>Accueil:</strong> <a href="<%= url_for('/') %>"><%= url_for('/') %></a></li>
                                <li><strong>CSS:</strong> <code><%= url_for('/css/layering-emergency-fix.css') %></code></li>
                                <li><strong>JS:</strong> <code><%= url_for('/js/layering-emergency-fix.js') %></code></li>
                            </ul>
                        </div>
                        
                        <!-- Contenu long pour tester le scroll -->
                        <div class="test-section">
                            <h2>Test 7: Scroll et Header Sticky</h2>
                            <p>Scrollez vers le bas pour tester le comportement du header sticky.</p>
                            <div style="height: 150vh; background: linear-gradient(to bottom, #f8fafc, #e2e8f0); padding: 2rem; border-radius: 8px; position: relative;">
                                <p><strong>Début du contenu de scroll</strong></p>
                                <p>Le header doit rester visible en haut de la page...</p>
                                <div style="position: absolute; bottom: 2rem; left: 2rem;">
                                    <p><strong>Fin du contenu de scroll</strong></p>
                                    <p>Si vous voyez ce texte, le scroll fonctionne !</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="test-section">
                            <h2>🎯 Résultats des Tests</h2>
                            <div id="test-results">
                                <p>Les tests se lancent automatiquement...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modal de test -->
    <div class="modal" id="test-modal" style="display: none;">
        <div class="modal-backdrop"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h3>Modal de Test Hexo</h3>
                <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">×</button>
            </div>
            <div class="modal-content">
                <p>Cette modal teste le z-index dans l'environnement Hexo.</p>
                <p><strong>Site:</strong> <%= config.title %></p>
                <button class="test-button" onclick="closeModal()">Fermer</button>
            </div>
        </div>
    </div>
    
    <!-- Scripts avec url_for -->
    <script src="<%= url_for('/js/dev-theme.js') %>"></script>
    
    <!-- SCRIPT DE CORRECTION D'URGENCE -->
    <script src="<%= url_for('/js/layering-emergency-fix.js') %>"></script>
    
    <script>
        // Tests automatiques pour Hexo
        function runHexoTests() {
            const results = [];
            
            // Test 1: Header
            const header = document.querySelector('.page-header, .dev-header');
            const headerStatus = document.getElementById('header-status');
            if (header) {
                const position = window.getComputedStyle(header).position;
                const zIndex = window.getComputedStyle(header).zIndex;
                if (position === 'sticky' && parseInt(zIndex) >= 1100) {
                    headerStatus.textContent = '✅ OK';
                    headerStatus.className = 'test-status status-ok';
                    results.push('Header: ✅ OK');
                } else {
                    headerStatus.textContent = '❌ Erreur';
                    headerStatus.className = 'test-status status-error';
                    results.push('Header: ❌ Erreur');
                }
            }
            
            // Test 2: Sidebar
            const sidebar = document.querySelector('.dev-sidebar, #dev-sidebar');
            const sidebarStatus = document.getElementById('sidebar-status');
            if (sidebar) {
                const position = window.getComputedStyle(sidebar).position;
                const expectedPosition = window.innerWidth <= 1023 ? 'fixed' : 'sticky';
                if (position === expectedPosition) {
                    sidebarStatus.textContent = '✅ OK';
                    sidebarStatus.className = 'test-status status-ok';
                    results.push('Sidebar: ✅ OK');
                } else {
                    sidebarStatus.textContent = '❌ Erreur';
                    sidebarStatus.className = 'test-status status-error';
                    results.push('Sidebar: ❌ Erreur');
                }
            }
            
            // Test 3: Z-Index
            testZIndex();
            
            // Afficher les résultats
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h4>Résultats:</h4><ul>' + 
                results.map(r => '<li>' + r + '</li>').join('') + 
                '</ul>';
            
            console.log('🧪 Tests Hexo terminés:', results);
        }
        
        function testSidebar() {
            const sidebar = document.querySelector('.dev-sidebar, #dev-sidebar');
            const toggle = document.querySelector('.dev-sidebar-toggle');
            
            if (sidebar && toggle) {
                toggle.click();
                setTimeout(() => {
                    const isOpen = sidebar.classList.contains('dev-sidebar-open') || 
                                   sidebar.classList.contains('dev-sidebar--open');
                    alert(isOpen ? 'Sidebar ouverte ✅' : 'Test effectué - Vérifiez visuellement');
                }, 300);
            } else {
                alert('Sidebar ou toggle non trouvé ❌');
            }
        }
        
        function testZIndex() {
            const root = document.documentElement;
            const zIndexVars = [
                '--z-index-sticky',
                '--z-index-modal', 
                '--z-index-docked'
            ];
            
            const definedVars = zIndexVars.filter(varName => {
                const value = getComputedStyle(root).getPropertyValue(varName);
                return value && value.trim() !== '';
            });
            
            const zindexStatus = document.getElementById('zindex-status');
            if (definedVars.length === zIndexVars.length) {
                zindexStatus.textContent = '✅ OK (' + definedVars.length + '/3)';
                zindexStatus.className = 'test-status status-ok';
            } else {
                zindexStatus.textContent = '❌ Manquant (' + definedVars.length + '/3)';
                zindexStatus.className = 'test-status status-error';
            }
        }
        
        function openModal() {
            document.getElementById('test-modal').style.display = 'flex';
        }
        
        function closeModal() {
            document.getElementById('test-modal').style.display = 'none';
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎯 Page de test Hexo chargée');
            console.log('Config Hexo:', {
                title: '<%= config.title %>',
                url: '<%= config.url %>',
                theme: '<%= config.theme %>'
            });
            
            // Ajouter bouton modal
            const button = document.createElement('button');
            button.textContent = 'Test Modal';
            button.className = 'test-button';
            button.onclick = openModal;
            document.querySelector('.test-content').appendChild(button);
            
            // Lancer les tests après un délai
            setTimeout(runHexoTests, 2000);
            
            // Relancer les tests lors du redimensionnement
            window.addEventListener('resize', () => {
                setTimeout(runHexoTests, 500);
            });
        });
        
        // Debug global pour Hexo
        window.debugHexoLayering = function() {
            console.log('=== DEBUG HEXO LAYERING ===');
            console.log('Site config:', {
                title: '<%= config.title %>',
                url: '<%= config.url %>',
                root: '<%= config.root %>',
                theme: '<%= config.theme %>'
            });
            
            console.log('URLs générées:', {
                css: '<%= url_for("/css/layering-emergency-fix.css") %>',
                js: '<%= url_for("/js/layering-emergency-fix.js") %>',
                home: '<%= url_for("/") %>'
            });
            
            if (window.EmergencyFix) {
                console.log('Réapplication des corrections...');
                window.EmergencyFix.init();
            }
            
            runHexoTests();
        };
    </script>
    
    <!-- Boutons de debug -->
    <div style="position: fixed; bottom: 20px; left: 20px; z-index: 9999; display: flex; gap: 10px;">
        <button onclick="debugHexoLayering()" style="background: #dc2626; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">
            🐛 Debug Hexo
        </button>
        <button onclick="runHexoTests()" style="background: #2563eb; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-size: 12px;">
            🧪 Re-test
        </button>
    </div>
</body>
</html>