<%# 
  Modern Article Layout
  Optimized typography and improved metadata display
%>

<article class="article" itemscope itemtype="https://schema.org/Article" lang="<%= page.lang || config.language %>">
  <div class="article-wrapper">
    <!-- Main Article Content -->
    <div class="article-main">
      <!-- Article Header -->
      <header class="article-header">
        <h1 class="article-title" itemprop="name headline" id="article-title">
          <%= page.title %>
        </h1>
        
        <!-- Article Metadata -->
        <div class="article-meta">
          <div class="article-meta-item">
            <svg class="article-meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            <time class="article-date" itemprop="datePublished" datetime="<%= page.date.toISOString() %>">
              <%= date(page.date, 'DD MMMM YYYY') %>
            </time>
          </div>
          
          <% if (!['journal'].includes(page.layout)) { %>
            <div class="article-meta-item">
              <svg class="article-meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12,6 12,12 16,14"></polyline>
              </svg>
              <span class="article-reading-time">
                <%= readingTime(page.content).text %>
              </span>
            </div>
          <% } %>
          
          <% if (page.categories && page.categories.length > 0) { %>
            <div class="article-meta-item">
              <svg class="article-meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
              </svg>
              <a href="<%= url_for(page.categories.first().path) %>" class="article-category" itemprop="about">
                <%= page.categories.first().name %>
              </a>
            </div>
          <% } %>
        </div>
        
        <!-- Article Cover Image -->
        <% if (page.cover || page.image) { %>
          <div class="article-cover">
            <img src="<%= page.image || page.cover %>" 
                 alt="<%= page.title %>" 
                 itemprop="image"
                 loading="eager"
                 width="800" 
                 height="400">
          </div>
        <% } %>
      </header>

      <!-- Article Content -->
      <div class="article-content" itemprop="articleBody">
        <%- page.content %>
      </div>

      <!-- Article Tags -->
      <% if (page.tags && page.tags.length > 0) { %>
        <div class="article-tags">
          <% page.tags.forEach(tag => { %>
            <a href="<%= url_for(tag.path) %>" class="article-tag" itemprop="keywords">
              <svg class="article-tag-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
              </svg>
              <%= tag.name %>
            </a>
          <% }) %>
        </div>
      <% } %>

      <!-- Article Footer -->
      <footer class="article-footer">
        <div class="article-actions">
          <% if (page.source) { %>
            <a href="https://github.com/thomas-iniguez-visioli/portfolio/tree/main/source/<%= page.source %>" 
               class="article-action" 
               target="_blank" 
               rel="noopener noreferrer">
              <svg class="article-action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
              Suggérer une modification
            </a>
          <% } %>
          
          <a href="<%= url_for('/archives/') %>" class="article-action">
            <svg class="article-action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
            Tous les articles
          </a>
          
          <a href="<%= url_for('/feed/') %>" class="article-action" type="application/rss+xml">
            <svg class="article-action-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 11a9 9 0 0 1 9 9"></path>
              <path d="M4 4a16 16 0 0 1 16 16"></path>
              <circle cx="5" cy="19" r="1"></circle>
            </svg>
            S'abonner au flux RSS
          </a>
        </div>
      </footer>
    </div>

    <!-- Article Sidebar -->
    <aside class="article-sidebar">
      <!-- Table of Contents -->
      <% if (is_post() && toc(page.content).length > 0) { %>
        <div class="article-toc">
          <h3>Table des matières</h3>
          <%- toc(page.content, {list_number: false, max_depth: 3}).replace(/>§/g, '>') %>
        </div>
      <% } %>
      
      <!-- Article Info -->
      <div class="article-info">
        <h3>Informations</h3>
        <div class="article-info-item">
          <strong>Publié le :</strong><br>
          <time datetime="<%= page.date.toISOString() %>">
            <%= date(page.date, 'DD MMMM YYYY') %>
          </time>
        </div>
        
        <% if (page.updated && page.updated.format() !== page.date.format()) { %>
          <div class="article-info-item">
            <strong>Mis à jour le :</strong><br>
            <time datetime="<%= page.updated.toISOString() %>">
              <%= date(page.updated, 'DD MMMM YYYY') %>
            </time>
          </div>
        <% } %>
        
        <% if (!['journal'].includes(page.layout)) { %>
          <div class="article-info-item">
            <strong>Temps de lecture :</strong><br>
            <%= readingTime(page.content).text %>
          </div>
        <% } %>
        
        <% if (page.categories && page.categories.length > 0) { %>
          <div class="article-info-item">
            <strong>Catégorie :</strong><br>
            <a href="<%= url_for(page.categories.first().path) %>">
              <%= page.categories.first().name %>
            </a>
          </div>
        <% } %>
      </div>
    </aside>
  </div>

  <!-- Related Articles -->
  <% if (is_post() && page.categories.first()) { %>
    <% const category = page.categories.first() %>
    <% const relatedPosts = category.posts.find({ _id: {$ne: page._id} }).sort('date', -1).limit(3) %>
    <% if (relatedPosts.length > 0) { %>
      <section class="related-articles">
        <div class="container">
          <h3>Articles similaires</h3>
          <div class="related-articles-grid">
            <% relatedPosts.forEach(post => { %>
              <article class="card">
                <% if (post.cover || post.image) { %>
                  <div class="card-image-wrapper">
                    <img src="<%= post.image || post.cover %>" 
                         alt="<%= post.title %>" 
                         class="card-image"
                         loading="lazy">
                  </div>
                <% } %>
                
                <div class="card-content">
                  <div class="card-header">
                    <div class="card-icon">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                      </svg>
                    </div>
                    <div>
                      <p class="card-subtitle">Article</p>
                      <h4 class="card-title">
                        <a href="<%= url_for(post.path) %>" rel="bookmark">
                          <%= post.title %>
                        </a>
                      </h4>
                    </div>
                  </div>
                  
                  <p class="card-description">
                    <%- post.excerpt || strip_html(post.content).substring(0, 120) + '...' %>
                  </p>
                  
                  <div class="card-meta">
                    <time class="card-date" datetime="<%= post.date.toISOString() %>">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                      </svg>
                      <%= date(post.date) %>
                    </time>
                  </div>
                </div>
              </article>
            <% }) %>
          </div>
        </div>
      </section>
    <% } %>
  <% } %>
</article>