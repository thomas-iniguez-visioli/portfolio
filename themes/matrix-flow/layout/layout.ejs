<!DOCTYPE html>
<html lang="<%- config.language %>">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%- page.title ? page.title + ' | ' : '' %><%- config.title %></title>
  
  <!-- Include CSS helper functions -->
  <%- partial('_partial/css-helpers') %>
  
  <!-- Resource hints for better performance -->
  <%- resource_hints() %>
  
  <!-- Critical CSS inlined for faster rendering -->

  
  <!-- Performance configuration -->

  <!-- Non-critical CSS loaded asynchronously -->

  
  <!-- Fonts with optimized loading -->

</head>
<body>
  <canvas id="matrix-canvas"></canvas>
  <div class="fullscreen-container">
    <div class="responsive-grid">
      <header class="site-header">
        <div class="logo-glitch" data-text="<%- theme.glitch_text || config.author %>">
          <a href="<%- url_for('/') %>"><%- theme.glitch_text || config.author %></a>
        </div>
        <nav class="main-nav">
          <% for (var i in theme.menu) { %>
            <a href="<%- url_for(theme.menu[i]) %>" class="nav-item">[<%- i %>]</a>
          <% } %>
        </nav>
      </header>
      
      <main class="site-main">
        <div class="main-content">
          <%- body %>
        </div>
      </main>
      
      <aside class="sidebar">
        <%- partial('_partial/sidebar') %>
      </aside>
      
      <footer class="site-footer">
        <p>&copy; <%= new Date().getFullYear() %> <%- config.author %>. All rights reserved.</p>
        <p class="social-links">
          <% if (theme.social.github) { %>
            <a href="https://github.com/<%= theme.social.github %>" target="_blank">[GitHub]</a>
          <% } %>
          <% if (theme.social.linkedin) { %>
            <a href="https://linkedin.com/in/<%= theme.social.linkedin %>" target="_blank">[LinkedIn]</a>
          <% } %>
          <% if (theme.social.email) { %>
            <a href="mailto:<%= theme.social.email %>">[Email]</a>
          <% } %>
        </p>
      </footer>
    </div>
  </div>
  <script>
    // Newsletter configuration
    window.NEWSLETTER_CONFIG = {
      github_owner: '<%- theme.newsletter?.github_owner || "your-username" %>',
      github_repo: '<%- theme.newsletter?.github_repo || "your-repo" %>',
      use_github_redirect: <%- theme.newsletter?.use_github_redirect || true %>,
      api_endpoint: '<%- theme.newsletter?.api_endpoint || "" %>'
    };
  </script>
  <!-- Critical JavaScript loaded immediately with optimizations -->
  <script src="<%- url_for('/js/code-splitter.js') %>" async></script>
  <script src="<%- url_for('/js/resource-preloader.js') %>" async></script>
  <script src="<%- url_for('/js/module-loader.js') %>" async></script>
  <script src="<%- url_for('/js/performance-monitor.js') %>" defer></script>
  
  <!-- Optimized module loading -->
  <script>
    // Initialize optimized loading system
    document.addEventListener('DOMContentLoaded', function() {
      // Setup code splitting and resource preloading
      if (window.codeSplitter) {
        window.codeSplitter.setupInteractionPreloading();
        window.codeSplitter.setupViewportBasedLoading();
        window.codeSplitter.setupIdleLoading();
      }
      
      if (window.resourcePreloader) {
        window.resourcePreloader.setupBehaviorBasedPreloading();
      }
      
      // Load modules based on page content
      const hasNewsletter = document.querySelector('[data-modules*="newsletter"]');
      const hasLazyImages = document.querySelector('img[data-src]');
      
      if (hasNewsletter && window.codeSplitter) {
        window.codeSplitter.loadModule('newsletter');
      }
      
      if (hasLazyImages && window.codeSplitter) {
        window.codeSplitter.loadModule('lazy-loader');
      }
    });
    
    // Preload resources on user interaction
    ['mousedown', 'touchstart', 'keydown'].forEach(event => {
      document.addEventListener(event, function() {
        if (window.resourcePreloader) {
          window.resourcePreloader.preloadScript('<%- url_for('/js/newsletter.js') %>', 'high');
          window.resourcePreloader.preloadScript('<%- url_for('/js/lazy-loader.js') %>', 'medium');
        }
      }, { once: true, passive: true });
    });
  </script>
</body>
</html>
